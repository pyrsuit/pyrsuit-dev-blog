<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="./favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="./_app/immutable/assets/0.cNCN8xyH.css" rel="stylesheet">
		<link rel="modulepreload" href="./_app/immutable/entry/start.BCouIEYd.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CS1CRA1e.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CIoNxzmP.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/BMTPmY8n.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DIeogL5L.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DPas0Zgu.js">
		<link rel="modulepreload" href="./_app/immutable/entry/app.tnldXXDC.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CWj6FrbW.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/BO__fVWV.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/BqdauxaP.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/0.GlzbFLFo.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/69_IOA4Y.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DRHO6HA-.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/BTdV8j6D.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/5.Cu6R7swf.js"><!--[--><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300&amp;display=swap" rel="stylesheet"/><!--]-->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><nav class="bg-yellow-50 p-4 flex justify-center gap-10 shadow-sm"><!--[--><a href="./" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-yarsvo" style="font-family: 'Montserrat', sans-serif;">About</a><a href="./feed" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-yarsvo" style="font-family: 'Montserrat', sans-serif;">Feed</a><a href="./til" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-yarsvo" style="font-family: 'Montserrat', sans-serif;">TIL</a><a href="./lab" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-yarsvo" style="font-family: 'Montserrat', sans-serif;">Lab</a><!--]--></nav> <main class="min-h-screen flex flex-col items-center justify-center bg-yellow-50 text-black px-4" style="font-family: 'Montserrat', sans-serif;"><!----><!----><section class="w-full max-w-5xl mx-auto px-6 pt-4 pb-16 space-y-8"><!--[--><article><div class="flex items-baseline justify-between mb-2"><h2 class="text-2xl font-light tracking-tight">Prometheus + Multiprocess Apps: A Lesson from the Trenches</h2> <time class="text-sm text-gray-600 ml-4">2025-07-13</time></div> <div class="text-base text-gray-800 leading-relaxed"><!----><p>I recently deployed an API in <code>Kubernetes</code> with a number of replicas, each running multiple <code>uWSGI</code> workers. I exposed a <code>/metrics</code> endpoint for <code>Prometheus</code> scraping â€” all looked good.</p>
<p>&nbsp;</p>
<p>Until I realizedâ€¦ the metrics were off ðŸ« </p>
<p>&nbsp;</p>
<p>Turns out, when you&#39;re using multiple <code>uWSGI</code> workers, <code>Prometheus</code>&#39; Python client needs <strong>multiprocess mode</strong> enabled to aggregate metrics across all worker processes. Without it, each process exposes its own separate metrics â€” so counters, for example, appear to jump up and down instead of increasing cumulatively across all workers. </p>
<p>&nbsp;</p>
<p>âœ… <strong>Fix:</strong> Configured <strong><a href="https://prometheus.github.io/client_python/multiprocess/">multiprocess mode</a></strong>, so all workers to write metrics to a shared directory.</p>
<p>&nbsp;</p>
<p>ðŸ’¡ <strong>Takeaway</strong>: With multiple workers per replica, <code>Prometheus</code> scrapes the <code>/metrics</code> endpoint from only one worker per replica at random â€” so without multiprocess mode, your <code>Prometheus</code> metrics won&#39;t reflect the true state of your API â€” making it impossible to accurately track what&#39;s really happening.</p>
<!----></div> <!--[!--><!--]--></article><!--]--></section><!----><!----></main><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_2ckbh3 = {
						base: new URL(".", location).pathname.slice(0, -1),
						assets: "/pyrsuit-dev-blog"
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("./_app/immutable/entry/start.BCouIEYd.js"),
						import("./_app/immutable/entry/app.tnldXXDC.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
