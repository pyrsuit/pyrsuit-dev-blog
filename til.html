<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<!-- <link rel="icon" href="./favicon.png" /> -->
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="./_app/immutable/assets/0.CjEmQ-1O.css" rel="stylesheet">
		<link href="./_app/immutable/assets/5.DyHMkdgm.css" rel="stylesheet">
		<link rel="modulepreload" href="./_app/immutable/entry/start.DiBXT1ti.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/C70jJq9Q.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/BQKW94_3.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/BL34K8iG.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DIeogL5L.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/PihmmPUa.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Dyt0YyFN.js">
		<link rel="modulepreload" href="./_app/immutable/entry/app.SBYfHzlY.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CWj6FrbW.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/C5S1ovEm.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DJ82RvA8.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/0.DsmrYyjc.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/69_IOA4Y.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CB1J4oH8.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/D8rofwjd.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/42L8Ptez.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/5.0D6NGtyF.js"><!--[--><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300&amp;display=swap" rel="stylesheet"/><!--]-->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><nav class="bg-yellow-50 p-4 flex justify-center gap-10 shadow-sm"><!--[--><a href="./" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-yarsvo" style="font-family: 'Montserrat', sans-serif;">About</a><a href="./feed" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-yarsvo" style="font-family: 'Montserrat', sans-serif;">Feed</a><a href="./til" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-yarsvo" style="font-family: 'Montserrat', sans-serif;">TIL</a><a href="./lab" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-yarsvo" style="font-family: 'Montserrat', sans-serif;">Lab</a><!--]--></nav> <main class="min-h-screen flex flex-col items-center justify-center bg-yellow-50 text-black px-4" style="font-family: 'Montserrat', sans-serif;"><!----><!----><section class="w-full max-w-5xl mx-auto px-6 pt-4 pb-16 space-y-8"><!--[--><article><div class="flex items-baseline justify-between mb-2"><h2 class="text-2xl font-light tracking-tight">When metrics eat your memory ğŸ§  ğŸ½ï¸</h2> <time class="text-sm text-gray-600 ml-4">2025-07-24</time></div> <div class="markdown-content text-base text-gray-800 leading-relaxed"><!----><p>Follow-up to my earlier post on Prometheus + Multiprocess Apps ... </p>
<p>&nbsp;</p>
<p>A few days in, I noticed the metrics directory was ballooning in memory ğŸˆ </p>
<p>&nbsp;</p>
<p>Digging in, I realized the Prometheus Python client (in multiprocess mode) writes separate files per metric per process. By default, those files are named things like <code>counter_12345.db</code>, where <code>12345</code> is the PID.</p>
<p>&nbsp;</p>
<p>So when a <code>uWSGI</code> worker dies and gets replaced â€” totally normal behavior â€” the new process gets its own set of metric files. But the old files? They just stay there.</p>
<p>&nbsp;</p>
<p>Since the client doesnâ€™t automatically clean up stale files, the directory just keeps growing.</p>
<p>&nbsp;</p>
<p>âœ… Fix: I configured a cleanup step to remove metrics for dead processes.</p>
<p>&nbsp;</p>
<p>ğŸ’¡ Takeaway: In multiprocess mode, the metrics client tracks data per PID. Without cleanup, these files accumulate and quietly consume memory â€” especially in environments with frequent process restarts.</p>
<!----></div> <!--[--><hr class="border-t border-gray-300 mt-6"/><!--]--></article><article><div class="flex items-baseline justify-between mb-2"><h2 class="text-2xl font-light tracking-tight">Goodbye temp venv hacks ğŸ‘‹</h2> <time class="text-sm text-gray-600 ml-4">2025-07-19</time></div> <div class="markdown-content text-base text-gray-800 leading-relaxed"><!----><p>Today I learned how much I enjoy using <code>uv</code> scripts for quick, one-off tasks.</p>
<p>&nbsp;</p>
<p>You can define dependencies right at the top of the script, and when you run it with <code>uv</code>, it spins up a temporary virtual environment automatically. Once the script finishes, the environment is destroyed â€” super clean ğŸ§¹</p>
<p>&nbsp;</p>
<p>This is perfect for things like initial tasks when starting a container, or scripts that import data, run a migration, or do any kind of setup that isn&#39;t needed once the main app is running.</p>
<p>&nbsp;</p>
<p>ğŸ’¡ <strong>Takeaway</strong>: <strong><a href="https://docs.astral.sh/uv/guides/scripts/">uv scripts</a></strong> give you a disposable, isolated environment without any manual setup â€” ideal for clean, repeatable scripting without leaving a mess behind.</p>
<!----></div> <!--[--><hr class="border-t border-gray-300 mt-6"/><!--]--></article><article><div class="flex items-baseline justify-between mb-2"><h2 class="text-2xl font-light tracking-tight">Prometheus + Multiprocess Apps: A Lesson from the Trenches</h2> <time class="text-sm text-gray-600 ml-4">2025-07-13</time></div> <div class="markdown-content text-base text-gray-800 leading-relaxed"><!----><p>I recently deployed an API using <code>uWSGI</code> with multiple workers. I exposed a <code>/metrics</code> endpoint for <code>Prometheus</code> scraping â€” all looked good.</p>
<p>&nbsp;</p>
<p>Until I realizedâ€¦ the metrics were off ğŸ« </p>
<p>&nbsp;</p>
<p>Turns out, when you&#39;re using multiple <code>uWSGI</code> workers, <code>Prometheus</code>&#39; Python client needs <strong>multiprocess mode</strong> enabled to aggregate metrics across all worker processes. Without it, each process exposes its own separate metrics â€” so counters, for example, appear to jump up and down instead of increasing cumulatively across all workers. </p>
<p>&nbsp;</p>
<p>âœ… <strong>Fix:</strong> Configured <strong><a href="https://prometheus.github.io/client_python/multiprocess/">multiprocess mode</a></strong>, so all workers write metrics to a shared directory.</p>
<p>&nbsp;</p>
<p>ğŸ’¡ <strong>Takeaway</strong>: With multiple workers per replica, <code>Prometheus</code> scrapes the <code>/metrics</code> endpoint from only one worker per replica at random â€” so without multiprocess mode, your <code>Prometheus</code> metrics won&#39;t reflect the true state of your API â€” making it impossible to accurately track what&#39;s really happening.</p>
<!----></div> <!--[!--><!--]--></article><!--]--></section><!----><!----></main><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_w0yehl = {
						base: new URL(".", location).pathname.slice(0, -1),
						assets: "/pyrsuit-dev-blog"
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("./_app/immutable/entry/start.DiBXT1ti.js"),
						import("./_app/immutable/entry/app.SBYfHzlY.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
