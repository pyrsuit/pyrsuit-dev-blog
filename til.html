<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<!-- <link rel="icon" href="./favicon.png" /> -->
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="./_app/immutable/assets/0.zjr9RkKc.css" rel="stylesheet">
		<link rel="modulepreload" href="./_app/immutable/entry/start.CadGcpOv.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DBaexPTZ.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Dxtxyj28.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DK8D298C.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/JY5l5D6Y.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/eVigdbh7.js">
		<link rel="modulepreload" href="./_app/immutable/entry/app.mxDdi_cS.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Dp1pzeXC.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Bzak7iHL.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DHz2Y3yU.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CSz6k_A3.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/0.LcxscAMP.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CcL8L1UM.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DLrSe-_4.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Bx_LN-Xl.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CcjtmNi5.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/5.CZnpY4jM.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Dq1ptKLK.js"><!--[--><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300&amp;display=swap" rel="stylesheet"/><!--]-->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><nav class="bg-yellow-50 p-4 flex justify-center gap-10 shadow-sm"><!--[--><a href="./" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-1jhqufd" style="font-family: 'Montserrat', sans-serif;">About</a><a href="./feed" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-1jhqufd" style="font-family: 'Montserrat', sans-serif;">Feed</a><a href="./til" class="text-black tracking-wide text-center cursor-pointer transition-all duration-300 font-extralight hover:font-semibold svelte-1jhqufd" style="font-family: 'Montserrat', sans-serif;">TIL</a><!--]--></nav> <main class="min-h-screen flex flex-col items-center justify-center bg-yellow-50 text-black px-4" style="font-family: 'Montserrat', sans-serif;"><!----><!----><section class="w-full max-w-5xl mx-auto px-6 pt-4 pb-16 space-y-8"><!--[--><article><div class="flex items-baseline justify-between mb-2"><h1 class="text-2xl font-light tracking-tight">Walrus operator: assign on the fly 🛫</h1> <time class="text-sm text-gray-600 ml-4">2025-08-25</time></div> <div class="markdown-content text-base text-gray-800 leading-relaxed"><!----><p>I recently discovered that Python has a neat operator for assigning a value and using it immediately: the <code>:=</code> operator, also called the walrus operator.</p>
<p>For example, instead of:</p>

      <div class="code-block">
        <small class="language-label">python</small>
        <pre><code class="language-python">value = data.get("key")
if value:
    print(len(value))</code></pre>
      </div>
    <p>You can do:</p>

      <div class="code-block">
        <small class="language-label">python</small>
        <pre><code class="language-python">if (value := data.get("key")):
    print(len(value))</code></pre>
      </div>
    <p>Boom 💥 value is assigned and ready to roll.</p>
<p>💡 <strong>Takeaway</strong>: <code>:=</code> = assign inline, use instantly, keep it neat.</p>
<!----></div> <!--[--><hr class="border-t border-gray-300 mt-6"/><!--]--></article><article><div class="flex items-baseline justify-between mb-2"><h1 class="text-2xl font-light tracking-tight">The one when TRUNCATE locked me out 🚪🔒</h1> <time class="text-sm text-gray-600 ml-4">2025-08-19</time></div> <div class="markdown-content text-base text-gray-800 leading-relaxed"><!----><p>While running <code>pytest</code> with <code>MySQL</code>, I kept hitting tests stuck on: <code>Waiting for table metadata lock</code> 😫 </p>
<p>Digging in, I found the culprit: my fixtures were using <code>TRUNCATE TABLE</code> to clean test data between runs. </p>
<p>Here&#39;s the catch: In MySQL, <code>TRUNCATE</code> is <strong><a href="https://en.wikipedia.org/wiki/Data_definition_language">DDL</a></strong>, not <strong><a href="https://en.wikipedia.org/wiki/Data_manipulation_language">DML</a></strong>. It drops/recreates the table under the hood, resets <code>AUTO_INCREMENT</code>, and requires an <strong>exclusive metadata lock</strong>. If any transaction has touched the table — even just a <code>SELECT</code> — <code>TRUNCATE</code> will block until that lock is released. In <code>pytest</code>, with long-lived connections, this happened constantly. </p>
<p>✅ <strong>Fix:</strong> switched to <code>DELETE FROM</code> table for cleanup. <code>DELETE</code> is <code>DML</code>, transactional, and only takes row locks + short metadata locks. It doesn&#39;t reset <code>AUTO_INCREMENT</code>, but it doesn&#39;t block other transactions either. </p>
<p>💡 <strong>Takeaway:</strong>: In <code>MySQL</code> tests, prefer <code>DELETE</code> over TRUNCATE unless you can guarantee no open transactions. </p>
<p>🔄 <strong>Postgres comparison</strong>: <code>TRUNCATE</code> in <code>Postgres</code> is transactional — you can roll it back, and it doesn&#39;t block in the same way. It still takes stricter locks than <code>DELETE</code>, but because <code>Postgres</code> metadata locking is less rigid, it rarely causes the same “hung DDL” issues you see in <code>MySQL</code>.</p>
<!----></div> <!--[--><hr class="border-t border-gray-300 mt-6"/><!--]--></article><article><div class="flex items-baseline justify-between mb-2"><h1 class="text-2xl font-light tracking-tight">When metrics eat your memory 🧠 🍽️</h1> <time class="text-sm text-gray-600 ml-4">2025-07-24</time></div> <div class="markdown-content text-base text-gray-800 leading-relaxed"><!----><p>Follow-up to my earlier post on Prometheus + Multiprocess Apps ... </p>
<p>A few days in, I noticed the metrics directory was ballooning in memory 🎈 </p>
<p>Digging in, I realized the Prometheus Python client (in multiprocess mode) writes separate files per metric per process. By default, those files are named things like <code>counter_12345.db</code>, where <code>12345</code> is the PID.</p>
<p>So when a <code>uWSGI</code> worker dies and gets replaced — totally normal behavior — the new process gets its own set of metric files. But the old files? They just stay there.</p>
<p>Since the client doesn’t automatically clean up stale files, the directory just keeps growing.</p>
<p>✅ Fix: I configured a cleanup step to remove metrics for dead processes.</p>
<p>💡 Takeaway: In multiprocess mode, the metrics client tracks data per PID. Without cleanup, these files accumulate and quietly consume memory — especially in environments with frequent process restarts.</p>
<!----></div> <!--[--><hr class="border-t border-gray-300 mt-6"/><!--]--></article><article><div class="flex items-baseline justify-between mb-2"><h1 class="text-2xl font-light tracking-tight">Goodbye temp venv hacks 👋</h1> <time class="text-sm text-gray-600 ml-4">2025-07-19</time></div> <div class="markdown-content text-base text-gray-800 leading-relaxed"><!----><p>Today I learned how much I enjoy using <code>uv</code> scripts for quick, one-off tasks.</p>
<p>You can define dependencies right at the top of the script, and when you run it with <code>uv</code>, it spins up a temporary virtual environment automatically. Once the script finishes, the environment is destroyed — super clean 🧹</p>
<p>This is perfect for things like initial tasks when starting a container, or scripts that import data, run a migration, or do any kind of setup that isn&#39;t needed once the main app is running.</p>
<p>💡 <strong>Takeaway</strong>: <strong><a href="https://docs.astral.sh/uv/guides/scripts/">uv scripts</a></strong> give you a disposable, isolated environment without any manual setup — ideal for clean, repeatable scripting without leaving a mess behind.</p>
<!----></div> <!--[--><hr class="border-t border-gray-300 mt-6"/><!--]--></article><article><div class="flex items-baseline justify-between mb-2"><h1 class="text-2xl font-light tracking-tight">Prometheus + multiprocess apps: A lesson from the trenches</h1> <time class="text-sm text-gray-600 ml-4">2025-07-13</time></div> <div class="markdown-content text-base text-gray-800 leading-relaxed"><!----><p>I recently deployed an API using <code>uWSGI</code> with multiple workers. I exposed a <code>/metrics</code> endpoint for <code>Prometheus</code> scraping — all looked good.</p>
<p>Until I realized… the metrics were off 🫠</p>
<p>Turns out, when you&#39;re using multiple <code>uWSGI</code> workers, <code>Prometheus</code>&#39; Python client needs <strong>multiprocess mode</strong> enabled to aggregate metrics across all worker processes. Without it, each process exposes its own separate metrics — so counters, for example, appear to jump up and down instead of increasing cumulatively across all workers. </p>
<p>✅ <strong>Fix:</strong> Configured <strong><a href="https://prometheus.github.io/client_python/multiprocess/">multiprocess mode</a></strong>, so all workers write metrics to a shared directory.</p>
<p>💡 <strong>Takeaway</strong>: With multiple workers per replica, <code>Prometheus</code> scrapes the <code>/metrics</code> endpoint from only one worker per replica at random — so without multiprocess mode, your <code>Prometheus</code> metrics won&#39;t reflect the true state of your API — making it impossible to accurately track what&#39;s really happening.</p>
<!----></div> <!--[!--><!--]--></article><!--]--></section><!----><!----></main><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_wohcwm = {
						base: new URL(".", location).pathname.slice(0, -1),
						assets: "/pyrsuit-dev-blog"
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("./_app/immutable/entry/start.CadGcpOv.js"),
						import("./_app/immutable/entry/app.mxDdi_cS.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data: [null,null],
							form: null,
							error: null,
							remote: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
